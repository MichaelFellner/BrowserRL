<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Green Box Controller</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
  <style>
    canvas { border: 1px solid #555; }
    #controls { margin-top: 10px; }
    button { margin: 4px; padding: 6px 12px; font-size: 16px; }
    input[type="number"] { width: 80px; margin-left: 4px; }
    #strokeWidth { width: 150px; }
  </style>
</head>
<body>
  <h2>Draw a Path From the Green Box to the Red Box</h2>
  <p>Click run value iteration to run the planning algorithm in the background until converge of 0.0001 is reached. You can override the convergence thershold and discount rate in the input fields before running value iteration. 
    After running value iteration, click on run optimal policy to see the green box follow the best path that was reached. You can also see the amount of iterations value iteration took to reach convergence where it says "iterations" in bold.
  </p>
  <p>
    Click run live value iteration to see what decisions are made live. Click it again to see if the decisions update on a new pass. You can control how fast the live iteration goes with the speed delay field thing, and you can have it run multiple times
    in a row automatically with the iterations field.
  </p>
  <canvas id="c" width="1000" height="600"></canvas>

  <div id="controls">
    <!-- stroke-width slider for drawing -->
    <label>Stroke Width:
      <input type="range" id="strokeWidth" min="60" max="100" value="5">
    </label>
    <br><br>

    <!-- manual move buttons -->
    <button onclick="manualMove(0)">↑ Up</button>
    <button onclick="manualMove(1)">↓ Down</button>
    <button onclick="manualMove(2)">← Left</button>
    <button onclick="manualMove(3)">→ Right</button>
    <br><br>
    <button onclick="resetEverything()">Reset Everything</button>
<br>

    <!-- γ and ε inputs -->
    <label>discount rate:
      <input id="gamma" type="number" step="0.01" placeholder="0.99">
    </label>
    <label>convergence threshold:
      <input id="threshold" type="number" step="1e-6" placeholder="1e-4">
    </label>
    <br><br>

    <!-- RL buttons -->
    <button onclick="runValueIterationClientSide()">Run Value Iteration</button>
    <button onclick="followValuePolicy()">Follow Optimal Policy</button>
    <button onclick="prepareLiveValueIteration()">Run Live Value Iteration</button>

  </div>
  <div id="iterationCount" style="margin-top: 10px; font-weight: bold;">Iterations: -</div>
  <button onclick="resetGreenBox()">Reset Green Box</button>
  <button onclick="followValuePolicy()">Follow Live Policy</button>
  <div id="deltaDisplay" style="margin-top: 4px; font-style: italic;">Δ: -</div>
  <label>Speed (ms delay):
    <input id="delayMs" type="number" placeholder="120" value="120">
  </label>
  <label>Iterations:
    <input id="liveIters" type="number" placeholder="1" value="1">
  </label>
  <p id="pathCheckResult">Path length: -</p>
  <button onclick="checkPolicyPathLength()">Check Policy Path Length</button>

  <button onclick="generateTrainingDataFromPolicy()">Generate Training Data</button>
<br>
<label>Train Epochs:
  <input id="epochsInput" type="number" value="10" min="1" style="width: 60px;">
</label>
<button onclick="trainNEpochs()">Train N Epochs</button>
<!-- Model Controls -->
<button onclick="createAndStoreModel()">Create Model</button>

<label>Learning Rate:
  <input id="learningRateInput" type="number" step="0.0001" value="0.01" style="width: 80px;">
</label>
<br><br>
<button onclick="followNNPolicy()">▶️ Follow NN Policy</button>



  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.14.0/dist/tf.min.js"></script>

  <script src="draw.js"></script>

</body>
</html>
